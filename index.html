<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bybit User Data Lookup</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #1e3a8a 0%, #0f172a 100%);
        }
        .card-gradient {
            background: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
        }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- Header -->
        <header class="text-center mb-12">
            <div class="flex justify-center items-center mb-4">
                <div class="w-12 h-12 bg-blue-500 rounded-lg flex items-center justify-center mr-3">
                    <i class="fas fa-chart-line text-white text-xl"></i>
                </div>
                <h1 class="text-4xl font-bold text-white">Bybit User Data Lookup</h1>
            </div>
            <p class="text-lg text-blue-200">Enter your Bybit UID to retrieve account information and trading data</p>
        </header>

        <!-- Connection Status -->
        <div id="connectionStatus" class="max-w-4xl mx-auto mb-6 bg-red-50 border border-red-200 rounded-lg p-4">
            <div class="flex items-center">
                <i class="fas fa-exclamation-triangle text-red-500 text-xl mr-3"></i>
                <div>
                    <h3 class="font-semibold text-red-800">Connection Issue Detected</h3>
                    <p class="text-red-700">Google Sheets data is not loading. Only demo data is available.</p>
                </div>
            </div>
            <div class="mt-3 flex gap-2">
                <button onclick="testGoogleScript()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm">
                    Test Google Script
                </button>
                <button onclick="showDataFixGuide()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">
                    Fix Data Connection
                </button>
            </div>
        </div>

        <!-- Main Content -->
        <div class="max-w-4xl mx-auto">
            <!-- Search Card -->
            <div class="card-gradient rounded-2xl shadow-2xl p-8 mb-8">
                <div class="text-center mb-8">
                    <h2 class="text-2xl font-bold text-gray-800 mb-2">Find Your Bybit Data</h2>
                    <p class="text-gray-600">Enter your unique Bybit UID to access your trading information</p>
                </div>

                <!-- Search Form -->
                <div class="space-y-6">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">
                            <i class="fas fa-user-circle mr-2 text-blue-500"></i>
                            Bybit UID
                        </label>
                        <input 
                            type="text" 
                            id="uidInput" 
                            placeholder="Enter your Bybit UID (e.g., 485218082)" 
                            class="w-full px-4 py-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent text-lg"
                        >
                    </div>

                    <div class="flex gap-4">
                        <button 
                            onclick="searchByUID()" 
                            class="flex-1 bg-blue-500 hover:bg-blue-600 text-white py-3 px-6 rounded-xl transition duration-200 font-semibold flex items-center justify-center"
                        >
                            <i class="fas fa-search mr-2"></i>
                            Search User Data
                        </button>
                        <button 
                            onclick="loadSampleData()" 
                            class="flex-1 bg-gray-500 hover:bg-gray-600 text-white py-3 px-6 rounded-xl transition duration-200 font-semibold flex items-center justify-center"
                        >
                            <i class="fas fa-eye mr-2"></i>
                            View Sample Data
                        </button>
                    </div>
                </div>

                <!-- Quick Examples -->
                <div class="mt-6 p-4 bg-blue-50 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-2 flex items-center">
                        <i class="fas fa-lightbulb mr-2"></i>
                        Available Demo UIDs:
                    </h4>
                    <div class="flex flex-wrap gap-2">
                        <button onclick="setUID('485218082')" class="text-sm bg-blue-100 hover:bg-blue-200 text-blue-700 px-3 py-2 rounded-lg transition duration-150">
                            UID: 485218082
                        </button>
                        <button onclick="setUID('485218083')" class="text-sm bg-green-100 hover:bg-green-200 text-green-700 px-3 py-2 rounded-lg transition duration-150">
                            UID: 485218083
                        </button>
                        <button onclick="setUID('485218084')" class="text-sm bg-purple-100 hover:bg-purple-200 text-purple-700 px-3 py-2 rounded-lg transition duration-150">
                            UID: 485218084
                        </button>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div id="resultsSection" class="hidden">
                <!-- User Found -->
                <div id="userFound" class="hidden">
                    <!-- User Summary -->
                    <div class="card-gradient rounded-2xl shadow-2xl p-6 mb-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="text-xl font-bold text-gray-800">
                                    <i class="fas fa-user-check text-green-500 mr-2"></i>
                                    User Found
                                </h3>
                                <p class="text-gray-600">UID: <span id="foundUID"></span> • <span id="dataSource" class="text-sm bg-blue-100 text-blue-700 px-2 py-1 rounded">Demo Data</span></p>
                            </div>
                            <div class="text-right">
                                <div class="text-2xl font-bold text-green-600" id="kycLevel"></div>
                                <div class="text-sm text-gray-500">KYC Level</div>
                            </div>
                        </div>
                    </div>

                    <!-- Main Data Card -->
                    <div class="card-gradient rounded-2xl shadow-2xl p-6 mb-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-database text-blue-500 mr-2"></i>
                            User Data Overview
                        </h3>
                        <div id="userData" class="space-y-4"></div>
                    </div>

                    <!-- Raw JSON Data -->
                    <div class="card-gradient rounded-2xl shadow-2xl p-6">
                        <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                            <i class="fas fa-code text-gray-500 mr-2"></i>
                            Complete Data
                        </h3>
                        <pre id="rawData" class="bg-gray-800 text-green-400 p-4 rounded-lg overflow-x-auto text-sm"></pre>
                    </div>
                </div>

                <!-- User Not Found -->
                <div id="userNotFound" class="hidden card-gradient rounded-2xl shadow-2xl p-8 text-center">
                    <div class="text-6xl text-yellow-500 mb-4">
                        <i class="fas fa-user-slash"></i>
                    </div>
                    <h3 class="text-2xl font-bold text-gray-800 mb-2">User Not Found</h3>
                    <p class="text-gray-600 mb-4" id="notFoundMessage">The UID you entered doesn't exist in our database.</p>
                    <div class="text-left bg-yellow-50 p-4 rounded-lg">
                        <h4 class="font-semibold text-yellow-800 mb-2">Current Status:</h4>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li id="statusLiveData" class="text-red-600">• ❌ Live Google Sheets data: Not connected</li>
                            <li class="text-green-600">• ✅ Demo data: Available (use demo UIDs above)</li>
                            <li class="text-yellow-600">• Only demo UIDs 485218082, 485218083, 485218084 are available</li>
                        </ul>
                    </div>
                </div>

                <!-- Loading State -->
                <div id="loadingState" class="hidden card-gradient rounded-2xl shadow-2xl p-8 text-center">
                    <div class="animate-spin rounded-full h-16 w-16 border-b-2 border-blue-500 mx-auto mb-4"></div>
                    <h3 class="text-xl font-bold text-gray-800 mb-2">Searching Database</h3>
                    <p class="text-gray-600">Looking up user information...</p>
                </div>
            </div>

            <!-- Manual Data Input -->
            <div class="card-gradient rounded-2xl shadow-2xl p-6 mt-8">
                <h3 class="text-xl font-bold text-gray-800 mb-4 flex items-center">
                    <i class="fas fa-plug text-orange-500 mr-2"></i>
                    Manual Data Input (Temporary Solution)
                </h3>
                <p class="text-gray-600 mb-4">Since Google Sheets isn't connecting, you can paste your data directly here:</p>
                <textarea 
                    id="manualDataInput" 
                    placeholder='Paste JSON data here. Example: [{"UID": 123456, "VIP Level": "VIP 1", ...}]' 
                    class="w-full h-40 p-4 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 text-sm font-mono"
                ></textarea>
                <div class="flex gap-2 mt-4">
                    <button onclick="loadManualData()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                        Load Manual Data
                    </button>
                    <button onclick="loadSampleJSON()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                        Load Sample JSON
                    </button>
                    <button onclick="clearManualData()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded">
                        Clear
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Data Fix Guide Modal -->
    <div id="fixGuideModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
        <div class="bg-white rounded-lg p-6 max-w-4xl w-full mx-4 max-h-96 overflow-y-auto">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold">Fix Google Sheets Connection</h3>
                <button onclick="hideFixGuide()" class="text-gray-500 hover:text-gray-700">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="space-y-4 text-sm">
                <div class="bg-red-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-red-800 mb-2">Current Issue: Data Not Loading</h4>
                    <p>Your Google Apps Script URL is correct, but no data is being returned.</p>
                </div>

                <div class="bg-blue-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-blue-800 mb-2">Step 1: Check Your Google Apps Script</h4>
                    <p>Make sure your script has this exact code:</p>
                    <pre class="bg-gray-800 text-green-400 p-3 rounded mt-2 text-xs overflow-x-auto">
function doGet() {
  try {
    // Replace with your actual sheet ID or use getActiveSheet()
    var sheet = SpreadsheetApp.openById('YOUR_SHEET_ID').getActiveSheet();
    // OR use: var sheet = SpreadsheetApp.getActiveSheet();
    
    var data = sheet.getDataRange().getValues();
    var headers = data[0];
    var jsonData = [];
    
    for (var i = 1; i < data.length; i++) {
      var row = {};
      for (var j = 0; j < headers.length; j++) {
        row[headers[j]] = data[i][j];
      }
      jsonData.push(row);
    }
    
    return ContentService.createTextOutput(JSON.stringify(jsonData))
      .setMimeType(ContentService.MimeType.JSON);
      
  } catch (error) {
    return ContentService.createTextOutput(JSON.stringify({
      error: error.toString(),
      message: "Check sheet ID and permissions"
    }))
    .setMimeType(ContentService.MimeType.JSON);
  }
}</pre>
                </div>

                <div class="bg-green-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-green-800 mb-2">Step 2: Test Your Script</h4>
                    <p>Open this URL in your browser to test:</p>
                    <p class="bg-gray-100 p-2 rounded break-all text-xs mt-2" id="testUrl"></p>
                    <p class="text-green-700 mt-2">You should see raw JSON data. If you see an error, check your script.</p>
                </div>

                <div class="bg-yellow-50 p-4 rounded-lg">
                    <h4 class="font-semibold text-yellow-800 mb-2">Step 3: Common Issues</h4>
                    <ul class="list-disc list-inside space-y-1 text-yellow-700">
                        <li>Sheet ID is incorrect in the script</li>
                        <li>Sheet is not shared publicly</li>
                        <li>No data in the sheet</li>
                        <li>Script not deployed as web app</li>
                        <li>Wrong deployment permissions</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <script>
        const scriptUrl = 'https://script.google.com/macros/s/AKfycbzf7Faa_Iuqx17TJ-Ok98-1v_Y4hXnnIGHt1XjxszVzb9SMjgIEWx4xVF6VEE9L7by6/exec';
        let allUserData = [];
        let usingLiveData = false;

        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('testUrl').textContent = scriptUrl;
            loadAllData();
        });

        // Load all data from Google Sheets
        async function loadAllData() {
            try {
                console.log('Attempting to load data from:', scriptUrl);
                const response = await fetch(scriptUrl);
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('Data received from Google Sheets:', data);
                
                if (Array.isArray(data) && data.length > 0) {
                    allUserData = data;
                    usingLiveData = true;
                    updateConnectionStatus('success', `Connected to Google Sheets! Loaded ${data.length} records.`);
                    console.log('Successfully loaded live data:', data);
                } else {
                    throw new Error('No data or empty array received');
                }
            } catch (error) {
                console.error('Error loading live data:', error);
                usingLiveData = false;
                updateConnectionStatus('error', `Google Sheets connection failed: ${error.message}`);
                // Load demo data
                loadDemoData();
            }
        }

        // Update connection status display
        function updateConnectionStatus(type, message) {
            const statusDiv = document.getElementById('connectionStatus');
            if (type === 'success') {
                statusDiv.className = 'max-w-4xl mx-auto mb-6 bg-green-50 border border-green-200 rounded-lg p-4';
                statusDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-check-circle text-green-500 text-xl mr-3"></i>
                        <div>
                            <h3 class="font-semibold text-green-800">Connected Successfully!</h3>
                            <p class="text-green-700">${message}</p>
                        </div>
                    </div>
                `;
            } else {
                statusDiv.className = 'max-w-4xl mx-auto mb-6 bg-red-50 border border-red-200 rounded-lg p-4';
                statusDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fas fa-exclamation-triangle text-red-500 text-xl mr-3"></i>
                        <div>
                            <h3 class="font-semibold text-red-800">Connection Issue</h3>
                            <p class="text-red-700">${message}</p>
                        </div>
                    </div>
                    <div class="mt-3 flex gap-2">
                        <button onclick="testGoogleScript()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded text-sm">
                            Test Google Script
                        </button>
                        <button onclick="showDataFixGuide()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded text-sm">
                            Fix Data Connection
                        </button>
                    </div>
                `;
            }
        }

        // Load demo data
        function loadDemoData() {
            allUserData = [
                {
                    "UID": 485218082,
                    "VIP Level": "VIP 1",
                    "User engagement": "Above 180",
                    "Joined Bybit": "2025-07-04T03:43:26.000Z",
                    "Source": "CSTAPPTELEGR",
                    "Remarks": "Active Trader",
                    "KYC(Lv.)": 1,
                    "Coin": "USDT",
                    "First-Time Deposited": "2025-07-05",
                    "Deposits Amount": 1500,
                    "TradingAmount": 12500,
                    "TakerAmount": 8000,
                    "MakerAmount": 4500,
                    "Interest": 25.50,
                    "Fee Profit": 45.75,
                    "Commissions": 12.30,
                    "Tradfi Amount": 3200,
                    "Rebate Coin": "USDT"
                },
                {
                    "UID": 485218083,
                    "VIP Level": "",
                    "User engagement": "Below 90",
                    "Joined Bybit": "2025-08-10T10:20:15.000Z",
                    "Source": "WEB",
                    "Remarks": "New User",
                    "KYC(Lv.)": 0,
                    "Coin": "USDT",
                    "First-Time Deposited": "",
                    "Deposits Amount": 0,
                    "TradingAmount": 0,
                    "TakerAmount": 0,
                    "MakerAmount": 0,
                    "Interest": 0,
                    "Fee Profit": 0,
                    "Commissions": 0,
                    "Tradfi Amount": 0,
                    "Rebate Coin": "USDT"
                },
                {
                    "UID": 485218084,
                    "VIP Level": "VIP 2",
                    "User engagement": "Above 180",
                    "Joined Bybit": "2025-06-15T08:30:00.000Z",
                    "Source": "REFERRAL",
                    "Remarks": "High Volume",
                    "KYC(Lv.)": 2,
                    "Coin": "USDT",
                    "First-Time Deposited": "2025-06-16",
                    "Deposits Amount": 5000,
                    "TradingAmount": 50000,
                    "TakerAmount": 30000,
                    "MakerAmount": 20000,
                    "Interest": 150.25,
                    "Fee Profit": 280.50,
                    "Commissions": 75.80,
                    "Tradfi Amount": 12000,
                    "Rebate Coin": "USDT"
                }
            ];
            console.log('Loaded demo data:', allUserData);
        }

        // Search by UID
        async function searchByUID() {
            const uidInput = document.getElementById('uidInput').value.trim();
            
            if (!uidInput) {
                alert('Please enter a Bybit UID');
                return;
            }

            showLoading();

            setTimeout(() => {
                try {
                    console.log('Searching for UID:', uidInput);
                    console.log('Available data source:', usingLiveData ? 'Google Sheets' : 'Demo Data');
                    console.log('Total records:', allUserData.length);
                    console.log('Available UIDs:', allUserData.map(u => u.UID));

                    let user = null;

                    // Try multiple matching strategies
                    const numericUID = Number(uidInput);
                    if (!isNaN(numericUID)) {
                        user = allUserData.find(u => Number(u.UID) === numericUID);
                    }

                    if (!user) {
                        user = allUserData.find(u => String(u.UID) === uidInput);
                    }

                    if (!user) {
                        user = allUserData.find(u => String(u.UID).toLowerCase() === uidInput.toLowerCase());
                    }

                    if (user) {
                        console.log('User found:', user);
                        displayUserData(user);
                    } else {
                        console.log('User not found. Available UIDs:', allUserData.map(u => u.UID));
                        updateNotFoundMessage(uidInput);
                        showUserNotFound();
                    }
                } catch (error) {
                    console.error('Search error:', error);
                    updateNotFoundMessage(`Search error: ${error.message}`);
                    showUserNotFound();
                }
            }, 1000);
        }

        // Display user data
        function displayUserData(user) {
            hideLoading();
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('userFound').classList.remove('hidden');
            document.getElementById('userNotFound').classList.add('hidden');

            // Update summary
            document.getElementById('foundUID').textContent = user.UID;
            document.getElementById('kycLevel').textContent = user['KYC(Lv.)'] || '0';
            document.getElementById('dataSource').textContent = usingLiveData ? 'Live Data' : 'Demo Data';
            document.getElementById('dataSource').className = usingLiveData ? 
                'text-sm bg-green-100 text-green-700 px-2 py-1 rounded' : 
                'text-sm bg-blue-100 text-blue-700 px-2 py-1 rounded';

            // Display detailed data
            const userDataDiv = document.getElementById('userData');
            userDataDiv.innerHTML = createUserDataHTML(user);

            // Display raw JSON
            document.getElementById('rawData').textContent = JSON.stringify(user, null, 2);
        }

        // Create HTML for user data display
        function createUserDataHTML(user) {
            const fields = [
                { label: 'VIP Level', value: user['VIP Level'] || 'Not Set', icon: 'crown', color: 'text-yellow-600' },
                { label: 'User Engagement', value: user['User engagement'] || 'Unknown', icon: 'activity', color: 'text-green-600' },
                { label: 'Joined Bybit', value: formatDate(user['Joined Bybit']), icon: 'calendar', color: 'text-blue-600' },
                { label: 'Source', value: user['Source'] || 'Unknown', icon: 'source', color: 'text-purple-600' },
                { label: 'Remarks', value: user['Remarks'] || 'None', icon: 'sticky-note', color: 'text-gray-600' },
                { label: 'Coin', value: user['Coin'] || 'USDT', icon: 'coins', color: 'text-yellow-500' },
                { label: 'First-Time Deposited', value: user['First-Time Deposited'] || 'Not Yet', icon: 'download', color: 'text-green-500' },
                { label: 'Deposits Amount', value: formatNumber(user['Deposits Amount'] || 0), icon: 'money-bill-wave', color: 'text-green-600' },
                { label: 'Trading Amount', value: formatNumber(user['TradingAmount'] || 0), icon: 'chart-bar', color: 'text-blue-500' },
                { label: 'Taker Amount', value: formatNumber(user['TakerAmount'] || 0), icon: 'arrow-up', color: 'text-red-500' },
                { label: 'Maker Amount', value: formatNumber(user['MakerAmount'] || 0), icon: 'arrow-down', color: 'text-blue-500' },
                { label: 'Interest', value: formatNumber(user['Interest'] || 0), icon: 'percent', color: 'text-purple-500' },
                { label: 'Fee Profit', value: formatNumber(user['Fee Profit'] || 0), icon: 'dollar-sign', color: 'text-green-500' },
                { label: 'Commissions', value: formatNumber(user['Commissions'] || 0), icon: 'hand-holding-usd', color: 'text-orange-500' },
                { label: 'Tradfi Amount', value: formatNumber(user['Tradfi Amount'] || 0), icon: 'exchange-alt', color: 'text-indigo-500' },
                { label: 'Rebate Coin', value: user['Rebate Coin'] || 'USDT', icon: 'gift', color: 'text-pink-500' }
            ];

            return fields.map(field => `
                <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                    <div class="flex items-center">
                        <i class="fas fa-${field.icon} ${field.color} mr-3"></i>
                        <div>
                            <div class="font-semibold text-gray-700">${field.label}</div>
                            <div class="text-sm text-gray-500">${field.value}</div>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        // Show user not found
        function showUserNotFound() {
            hideLoading();
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('userFound').classList.add('hidden');
            document.getElementById('userNotFound').classList.remove('hidden');
            
            // Update live data status
            const statusItem = document.getElementById('statusLiveData');
            if (usingLiveData) {
                statusItem.className = 'text-green-600';
                statusItem.innerHTML = '• ✅ Live Google Sheets data: Connected';
            } else {
                statusItem.className = 'text-red-600';
                statusItem.innerHTML = '• ❌ Live Google Sheets data: Not connected';
            }
        }

        function updateNotFoundMessage(uid) {
            const message = `UID "${uid}" not found. ${usingLiveData ? 
                'This UID does not exist in the Google Sheets database.' : 
                'Only demo UIDs are available since Google Sheets is not connected.'}`;
            document.getElementById('notFoundMessage').textContent = message;
        }

        // Show loading state
        function showLoading() {
            document.getElementById('resultsSection').classList.remove('hidden');
            document.getElementById('userFound').classList.add('hidden');
            document.getElementById('userNotFound').classList.add('hidden');
            document.getElementById('loadingState').classList.remove('hidden');
        }

        // Hide loading state
        function hideLoading() {
            document.getElementById('loadingState').classList.add('hidden');
        }

        // Set UID from quick examples
        function setUID(uid) {
            document.getElementById('uidInput').value = uid;
        }

        // Load sample data for demonstration
        function loadSampleData() {
            const sampleUser = allUserData[0];
            setUID(sampleUser.UID);
            displayUserData(sampleUser);
        }

        // Manual data input
        function loadManualData() {
            const manualData = document.getElementById('manualDataInput').value.trim();
            if (!manualData) {
                alert('Please paste some JSON data first');
                return;
            }

            try {
                const parsedData = JSON.parse(manualData);
                const dataArray = Array.isArray(parsedData) ? parsedData : [parsedData];
                
                allUserData = dataArray;
                usingLiveData = true;
                updateConnectionStatus('success', `Loaded ${dataArray.length} records from manual input.`);
                
                console.log('Loaded manual data:', dataArray);
                alert(`Successfully loaded ${dataArray.length} records!`);
                
            } catch (error) {
                alert('Invalid JSON format. Please check your data.');
                console.error('JSON parse error:', error);
            }
        }

        function loadSampleJSON() {
            const sampleJSON = JSON.stringify(allUserData, null, 2);
            document.getElementById('manualDataInput').value = sampleJSON;
        }

        function clearManualData() {
            document.getElementById('manualDataInput').value = '';
        }

        // Test Google Script
        async function testGoogleScript() {
            try {
                const response = await fetch(scriptUrl);
                const data = await response.text();
                alert('Google Script Response:\n\n' + data.substring(0, 500) + (data.length > 500 ? '...' : ''));
            } catch (error) {
                alert('Test failed: ' + error.message);
            }
        }

        function showDataFixGuide() {
            document.getElementById('fixGuideModal').classList.remove('hidden');
        }

        function hideFixGuide() {
            document.getElementById('fixGuideModal').classList.add('hidden');
        }

        // Utility functions
        function formatNumber(num) {
            return new Intl.NumberFormat('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            }).format(num);
        }

        function formatDate(dateString) {
            if (!dateString) return 'Unknown';
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            } catch {
                return dateString;
            }
        }

        // Enter key support
        document.getElementById('uidInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                searchByUID();
            }
        });
    </script>
</body>
</html>
